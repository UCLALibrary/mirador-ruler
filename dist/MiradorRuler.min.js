var MiradorRuler={locales:{en:{translation:{rulerSettingsTooltip:"Manage this window&#39;s ruler settings",hideRuler:"(hide ruler)",rulerColorBlack:"Black",rulerColorWhite:"White",rulerOrientationHorizontal:"Horizontal",rulerOrientationVertical:"Vertical",rulerPositionTopLeft:"Top Left",rulerPositionTopMiddle:"Top Middle",rulerPositionTopRight:"Top Right",rulerPositionMiddleLeft:"Middle Left",rulerPositionMiddleRight:"Middle Right",rulerPositionBottomLeft:"Bottom Left",rulerPositionBottomMiddle:"Bottom Middle",rulerPositionBottomRight:"Bottom Right"}}},template:Mirador.Handlebars.compile(['<a href="javascript:;" class="mirador-btn mirador-icon-ruler mirador-tooltip" title="{{t "rulerSettingsTooltip"}}">','<i class="fa fa-lg fa-fw ruler-icon-grey"></i>','<i class="fa fa-lg fa-fw ruler-icon"></i>','<i class="fa fa-caret-down"></i>','<ul class="dropdown ruler-options-list">','<li class="ruler-hide"><i class="fa fa-ban fa-lg fa-fw"></i> {{t "hideRuler"}}</li>','<li class="ruler-horizontal"><i class="fa fa-arrows-h fa-lg fa-fw"></i> {{t "rulerOrientationHorizontal"}}</li>','<li class="ruler-vertical"><i class="fa fa-arrows-v fa-lg fa-fw"></i> {{t "rulerOrientationVertical"}}</li>','<li class="ruler-black"><i class="fa fa-square fa-lg fa-fw"></i> {{t "rulerColorBlack"}}</li>','<li class="ruler-white"><i class="fa fa-square-o fa-lg fa-fw"></i> {{t "rulerColorWhite"}}</li>','<li class="ruler-top-left"><i class="fa fa- fa-lg fa-fw"></i> {{t "rulerPositionTopLeft"}}</li>','<li class="ruler-top-middle"><i class="fa fa- fa-lg fa-fw"></i> {{t "rulerPositionTopMiddle"}}</li>','<li class="ruler-top-right"><i class="fa fa- fa-lg fa-fw"></i> {{t "rulerPositionTopRight"}}</li>','<li class="ruler-middle-left"><i class="fa fa- fa-lg fa-fw"></i> {{t "rulerPositionMiddleLeft"}}</li>','<li class="ruler-middle-right"><i class="fa fa- fa-lg fa-fw"></i> {{t "rulerPositionMiddleRight"}}</li>','<li class="ruler-bottom-left"><i class="fa fa- fa-lg fa-fw"></i> {{t "rulerPositionBottomLeft"}}</li>','<li class="ruler-bottom-middle"><i class="fa fa- fa-lg fa-fw"></i> {{t "rulerPositionBottomMiddle"}}</li>','<li class="ruler-bottom-right"><i class="fa fa- fa-lg fa-fw"></i> {{t "rulerPositionBottomRight"}}</li>',"</ul>","</a>"].join("")),settings:{type:3,minWidth:"300px",location:1,xOffset:10,yOffset:10,orientation:1,stayInsideImage:!1,color:"black",fontColor:"rgb(100, 100, 100)",backgroundColor:"rgba(255, 255, 255, 0.3)",fontSize:"small",barThickness:1},init:function(){var e=this;i18next.on("initialized",function(){for(var i in e.locales){var t="translation";i18next.addResourceBundle(i,t,e.locales[i][t],!0,!0)}}),function(i){var t=i.Window.prototype.bindEvents;i.Window.prototype.bindEvents=function(){var i=this;t.apply(this,arguments),this.element.find(".window-manifest-navigation").prepend(e.template()),this.element.find(".mirador-icon-ruler").on("mouseenter",function(){i.element.find(".ruler-options-list").stop().slideFadeToggle(300),i.element.find(".ruler-icon-grey").hide(),i.element.find(".ruler-icon").show()}).on("mouseleave",function(){i.element.find(".ruler-options-list").stop().slideFadeToggle(300),i.element.find(".ruler-icon").hide(),i.element.find(".ruler-icon-grey").show()}),i.element.find(".ruler-icon").hide(),this.element.find(".ruler-hide").on("click",function(){i.setRulerVisibility("invisible"),i.leading&&i.eventEmitter.publish("synchronizeRulerControls",{viewObj:i.focusModules[i.currentImageMode],value:{fn:"setRulerVisibility",arg:"invisible"}})}),this.element.find(".ruler-horizontal").on("click",function(){i.setRulerOrientation("horizontal"),i.leading&&i.eventEmitter.publish("synchronizeRulerControls",{viewObj:i.focusModules[i.currentImageMode],value:{fn:"setRulerOrientation",arg:"horizontal"}})}),this.element.find(".ruler-vertical").on("click",function(){i.setRulerOrientation("vertical"),i.leading&&i.eventEmitter.publish("synchronizeRulerControls",{viewObj:i.focusModules[i.currentImageMode],value:{fn:"setRulerOrientation",arg:"vertical"}})}),this.element.find(".ruler-black").on("click",function(){i.setRulerColor("black"),i.leading&&i.eventEmitter.publish("synchronizeRulerControls",{viewObj:i.focusModules[i.currentImageMode],value:{fn:"setRulerColor",arg:"black"}})}),this.element.find(".ruler-white").on("click",function(){i.setRulerColor("white"),i.leading&&i.eventEmitter.publish("synchronizeRulerControls",{viewObj:i.focusModules[i.currentImageMode],value:{fn:"setRulerColor",arg:"white"}})}),this.element.find(".ruler-top-left").on("click",function(){i.setRulerPosition("tl"),i.leading&&i.eventEmitter.publish("synchronizeRulerControls",{viewObj:i.focusModules[i.currentImageMode],value:{fn:"setRulerPosition",arg:"tl"}})}),this.element.find(".ruler-top-middle").on("click",function(){i.setRulerPosition("tm"),i.leading&&i.eventEmitter.publish("synchronizeRulerControls",{viewObj:i.focusModules[i.currentImageMode],value:{fn:"setRulerPosition",arg:"tm"}})}),this.element.find(".ruler-top-right").on("click",function(){i.setRulerPosition("tr"),i.leading&&i.eventEmitter.publish("synchronizeRulerControls",{viewObj:i.focusModules[i.currentImageMode],value:{fn:"setRulerPosition",arg:"tr"}})}),this.element.find(".ruler-middle-left").on("click",function(){i.setRulerPosition("ml"),i.leading&&i.eventEmitter.publish("synchronizeRulerControls",{viewObj:i.focusModules[i.currentImageMode],value:{fn:"setRulerPosition",arg:"ml"}})}),this.element.find(".ruler-middle-right").on("click",function(){i.setRulerPosition("mr"),i.leading&&i.eventEmitter.publish("synchronizeRulerControls",{viewObj:i.focusModules[i.currentImageMode],value:{fn:"setRulerPosition",arg:"mr"}})}),this.element.find(".ruler-bottom-left").on("click",function(){i.setRulerPosition("bl"),i.leading&&i.eventEmitter.publish("synchronizeRulerControls",{viewObj:i.focusModules[i.currentImageMode],value:{fn:"setRulerPosition",arg:"bl"}})}),this.element.find(".ruler-bottom-middle").on("click",function(){i.setRulerPosition("bm"),i.leading&&i.eventEmitter.publish("synchronizeRulerControls",{viewObj:i.focusModules[i.currentImageMode],value:{fn:"setRulerPosition",arg:"bm"}})}),this.element.find(".ruler-bottom-right").on("click",function(){i.setRulerPosition("br"),i.leading&&i.eventEmitter.publish("synchronizeRulerControls",{viewObj:i.focusModules[i.currentImageMode],value:{fn:"setRulerPosition",arg:"bm"}})})},i.Window.prototype.setRulerVisibility=function(e){var i=this.focusModules.ImageView.osd;if(i.hasPhysicalDimensionData){var t;"invisible"===e?t=OpenSeadragon.ScalebarType.NONE:"visible"===e&&(t=OpenSeadragon.ScalebarType.MACRO),i.scalebar({type:t})}},i.Window.prototype.setRulerOrientation=function(e){var i=this.focusModules.ImageView.osd;if(i.hasPhysicalDimensionData){var t;switch(e){case"horizontal":t=OpenSeadragon.ScalebarOrientation.HORIZONTAL;break;case"vertical":t=OpenSeadragon.ScalebarOrientation.VERTICAL}this.setRulerVisibility("visible"),i.scalebar({orientation:t})}},i.Window.prototype.setRulerColor=function(e){var i=this.focusModules.ImageView.osd;i.hasPhysicalDimensionData&&(this.setRulerVisibility("visible"),i.scalebar({color:e}))},i.Window.prototype.setRulerPosition=function(e){var i=this.focusModules.ImageView.osd;if(i.hasPhysicalDimensionData){var t;switch(e){case"tl":t=OpenSeadragon.ScalebarLocation.TOP_LEFT;break;case"tm":t=OpenSeadragon.ScalebarLocation.TOP_MIDDLE;break;case"tr":t=OpenSeadragon.ScalebarLocation.TOP_RIGHT;break;case"ml":t=OpenSeadragon.ScalebarLocation.MIDDLE_LEFT;break;case"mr":t=OpenSeadragon.ScalebarLocation.MIDDLE_RIGHT;break;case"bl":t=OpenSeadragon.ScalebarLocation.BOTTOM_LEFT;break;case"bm":t=OpenSeadragon.ScalebarLocation.BOTTOM_MIDDLE;break;case"br":t=OpenSeadragon.ScalebarLocation.BOTTOM_RIGHT}this.setRulerVisibility("visible"),i.scalebar({location:t})}}}(Mirador),function(i){var t=i.ImageView.prototype.listenForActions;i.ImageView.prototype.listenForActions=function(){var i=this;t.apply(this,arguments),this.eventEmitter.subscribe("image-status-updated"+this.windowId,function(t,l){"main"===l.getImageType()&&"drawn"===l.getStatus()&&jQuery.getJSON(l.tileSource).done(function(t){if(function(e){return"http://iiif.io/api/annex/services/physdim"===e.profile&&"http://iiif.io/api/annex/services/physdim/1/context.json"===e["@context"]||(console.warn("Physical dimension service is either invalid or not well-formed:"),console.warn(e),!1)}(t.service)){var l=1/({mm:.001,cm:.01,in:.0254}[t.service.physicalUnits]*t.service.physicalScale),o=jQuery.extend(!0,{},e.settings,{pixelsPerMeter:l});i.osd.scalebar(o),i.osd.hasPhysicalDimensionData=!0}else console.warn("Physical Dimension service for "+t.service["@id"]+" is invalid")})})}}(Mirador)}};$(document).ready(function(){MiradorRuler.init()});
!function(t){function i(t,i){return t._scaleSpring.current.value*t.viewport._containerInnerSize.x/t.source.dimensions.x*i}function e(t,i,e,s,r){r=void 0===r?" ":r;var o=a(t,i),h=n(o/t*i,3);return{size:o*i,text:h+r+e+(s&&h>1?"s":"")}}function s(t,i,e){var s=a(t,i);return{size:s*i,text:h(n(s/t*i,3),e)}}function a(t,i){var e=r(r(t)/r(i));return e>=5&&(e/=5),e>=4&&(e/=4),e>=2&&(e/=2),e}function r(t){return t*Math.pow(10,Math.ceil(-o(t)))}function n(t,i){var e=i- -Math.ceil(-o(t)),s=t*Math.pow(10,e);return e<0?Math.round(s)*Math.pow(10,-e):Math.round(s)/Math.pow(10,e)}function o(t){return Math.log(t)/Math.log(10)}function h(t,i){return t<1e-6?1e9*t+" n"+i:t<.001?1e6*t+" Î¼"+i:t<1?1e3*t+" m"+i:t>=1e3?t/1e3+" k"+i:t+" "+i}function l(t){return void 0!==t}if(!t.version||t.version.major<2)throw new Error("This version of OpenSeadragonScalebar requires OpenSeadragon version 2.0.0+");t.Viewer.prototype.scalebar=function(i){this.scalebarInstance?this.scalebarInstance.refresh(i):((i=i||{}).viewer=this,this.scalebarInstance=new t.Scalebar(i))},t.ScalebarType={NONE:0,MICROSCOPY:1,MAP:2,MACRO:3},t.ScalebarLocation={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,MIDDLE_LEFT:5,MIDDLE_RIGHT:6,TOP_MIDDLE:7,BOTTOM_MIDDLE:8},t.ScalebarOrientation={HORIZONTAL:0,VERTICAL:1},t.Scalebar=function(i){if(!(i=i||{}).viewer)throw new Error("A viewer must be specified.");this.viewer=i.viewer,this.divElt=document.createElement("div"),this.viewer.container.appendChild(this.divElt),this.divElt.style.position="relative",this.divElt.style.margin="0",this.divElt.style.pointerEvents="none",this.setMinWidth(i.minWidth||"150px"),this.setDrawScalebarFunction(i.type||t.ScalebarType.MICROSCOPY),this.color=i.color||"black",this.fontColor=i.fontColor||"black",this.backgroundColor=i.backgroundColor||"none",this.fontSize=i.fontSize||"",this.fontFamily=i.fontFamily||"",this.barThickness=i.barThickness||2,this.pixelsPerMeter=i.pixelsPerMeter||null,this.referenceItemIdx=i.referenceItemIdx||0,this.location=i.location||t.ScalebarLocation.BOTTOM_LEFT,this.xOffset=i.xOffset||5,this.yOffset=i.yOffset||5,this.stayInsideImage=!l(i.stayInsideImage)||i.stayInsideImage,this.sizeAndTextRenderer=i.sizeAndTextRenderer||t.ScalebarSizeAndTextRenderer.METRIC_LENGTH,i.type===t.ScalebarType.MACRO?this.orientation=i.orientation||t.ScalebarOrientation.HORIZONTAL:this.orientation=t.ScalebarOrientation.HORIZONTAL;var e=this;this.viewer.addHandler("open",function(){e.refresh()}),this.viewer.addHandler("animation",function(){e.refresh()}),this.viewer.addHandler("resize",function(){e.refresh()})},t.Scalebar.prototype={updateOptions:function(t){t&&(l(t.type)&&this.setDrawScalebarFunction(t.type),l(t.minWidth)&&this.setMinWidth(t.minWidth),l(t.color)&&(this.color=t.color),l(t.fontColor)&&(this.fontColor=t.fontColor),l(t.backgroundColor)&&(this.backgroundColor=t.backgroundColor),l(t.fontSize)&&(this.fontSize=t.fontSize),l(t.fontFamily)&&(this.fontFamily=t.fontFamily),l(t.barThickness)&&(this.barThickness=t.barThickness),l(t.pixelsPerMeter)&&(this.pixelsPerMeter=t.pixelsPerMeter),l(t.referenceItemIdx)&&(this.referenceItemIdx=t.referenceItemIdx),l(t.location)&&(this.location=t.location),l(t.orientation)&&(this.orientation=t.orientation),l(t.xOffset)&&(this.xOffset=t.xOffset),l(t.yOffset)&&(this.yOffset=t.yOffset),l(t.stayInsideImage)&&(this.stayInsideImage=t.stayInsideImage),l(t.sizeAndTextRenderer)&&(this.sizeAndTextRenderer=t.sizeAndTextRenderer))},setDrawScalebarFunction:function(i){i?i===t.ScalebarType.MAP?this.drawScalebar=this.drawMapScalebar:i===t.ScalebarType.MICROSCOPY?this.drawScalebar=this.drawMicroscopyScalebar:this.drawScalebar=this.drawMacroScalebar:this.drawScalebar=null},setMinWidth:function(i){this.orientation===t.ScalebarOrientation.HORIZONTAL?this.divElt.style.width=i:this.divElt.style.height=i,this.divElt.style.display="",this.orientation===t.ScalebarOrientation.HORIZONTAL?this.minWidth=this.divElt.offsetWidth:this.minWidth=this.divElt.offsetHeight},refresh:function(t){if(this.updateOptions(t),this.viewer.isOpen()&&this.drawScalebar&&this.pixelsPerMeter&&this.location){this.divElt.style.display="";var e=this.viewer.viewport,s=i(this.viewer.world.getItemAt(this.referenceItemIdx),e.getZoom(!0))*this.pixelsPerMeter,a=this.sizeAndTextRenderer(s,this.minWidth);this.drawScalebar(a.size,a.text);var r=this.getScalebarLocation();this.divElt.style.left=r.x+"px",this.divElt.style.top=r.y+"px"}else this.divElt.style.display="none"},drawMicroscopyScalebar:function(t,i){this.divElt.style.fontSize=this.fontSize,this.divElt.style.fontFamily=this.fontFamily,this.divElt.style.textAlign="center",this.divElt.style.color=this.fontColor,this.divElt.style.border="none",this.divElt.style.borderBottom=this.barThickness+"px solid "+this.color,this.divElt.style.backgroundColor=this.backgroundColor,this.divElt.innerHTML=i,this.divElt.style.width=t+"px"},drawMapScalebar:function(t,i){this.divElt.style.fontSize=this.fontSize,this.divElt.style.fontFamily=this.fontFamily,this.divElt.style.textAlign="center",this.divElt.style.color=this.fontColor,this.divElt.style.border=this.barThickness+"px solid "+this.color,this.divElt.style.borderTop="none",this.divElt.style.backgroundColor=this.backgroundColor,this.divElt.innerHTML=i,this.divElt.style.width=t+"px"},drawMacroScalebar:function(i,e){var s=parseInt(e.replace(/[A-Za-z]| /g,"")),a=e.replace(/[0-9]|\.| /g,"");this.nMajorGradations=10===s?2:s/10,this.nMinorGradationsPerMajorGradation=10===s?5:10,this.nMinorGradations=this.nMinorGradationsPerMajorGradation*this.nMajorGradations;var r,n,o,h,l,c,d=100/this.nMinorGradations,v=this;switch(void 0!==this.svgEltLabels&&this.divElt.removeChild(this.svgEltLabels),void 0!==this.svgElt&&this.divElt.removeChild(this.svgElt),this.svgEltLabels=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svgElt=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svgElt.setAttribute("version","1.1"),this.svgEltLabels.setAttribute("version","1.1"),this.svgElt.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.svgEltLabels.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.orientation===t.ScalebarOrientation.HORIZONTAL?(h="x",l="y"):(h="y",l="x"),c={major:[0,100]},this.location){case t.ScalebarLocation.TOP_LEFT:case t.ScalebarLocation.TOP_MIDDLE:c.semimajor=[25,100],c.minor=[50,100],this.divElt.appendChild(this.svgEltLabels),this.divElt.appendChild(this.svgElt);break;case t.ScalebarLocation.BOTTOM_RIGHT:case t.ScalebarLocation.MIDDLE_RIGHT:c.semimajor=[0,75],c.minor=[0,50],this.divElt.appendChild(this.svgElt),this.divElt.appendChild(this.svgEltLabels);break;case t.ScalebarLocation.MIDDLE_LEFT:case t.ScalebarLocation.BOTTOM_MIDDLE:case t.ScalebarLocation.BOTTOM_LEFT:this.orientation===t.ScalebarOrientation.HORIZONTAL?(c.semimajor=[0,75],c.minor=[0,50],this.divElt.appendChild(this.svgElt),this.divElt.appendChild(this.svgEltLabels)):(c.semimajor=[25,100],c.minor=[50,100],this.divElt.appendChild(this.svgEltLabels),this.divElt.appendChild(this.svgElt));break;case t.ScalebarLocation.TOP_RIGHT:this.orientation===t.ScalebarOrientation.HORIZONTAL?(c.semimajor=[25,100],c.minor=[50,100],this.divElt.appendChild(this.svgEltLabels),this.divElt.appendChild(this.svgElt)):(c.semimajor=[0,75],c.minor=[0,50],this.divElt.appendChild(this.svgElt),this.divElt.appendChild(this.svgEltLabels))}var f=!1;if(this.orientation===t.ScalebarOrientation.HORIZONTAL)switch(this.location){case t.ScalebarLocation.TOP_LEFT:case t.ScalebarLocation.MIDDLE_LEFT:case t.ScalebarLocation.BOTTOM_LEFT:f=!0}else switch(this.location){case t.ScalebarLocation.TOP_LEFT:case t.ScalebarLocation.TOP_MIDDLE:case t.ScalebarLocation.TOP_RIGHT:f=!0}for(this.scaleNumbers=[],b=1;b<this.nMinorGradations;b++)n=document.createElementNS("http://www.w3.org/2000/svg","line"),this.svgElt.appendChild(n),b%this.nMinorGradationsPerMajorGradation==0?(o="major",r=document.createElementNS("http://www.w3.org/2000/svg","text"),!0===f?r.setAttribute(h,b*d+"%"):r.setAttribute(h,(this.nMinorGradations-b)*d+"%"),this.orientation===t.ScalebarOrientation.HORIZONTAL?r.setAttribute(l,"75%"):r.setAttribute(l,"0%"),r.style.fill=v.color,r.style.textShadow="none",this.scaleNumbers.push(r),this.svgEltLabels.appendChild(r)):o=b%(.5*this.nMinorGradationsPerMajorGradation)==0?"semimajor":"minor",!0===f?(n.setAttribute(h+"1",b*d+"%"),n.setAttribute(h+"2",b*d+"%")):(n.setAttribute(h+"1",(this.nMinorGradations-b)*d+"%"),n.setAttribute(h+"2",(this.nMinorGradations-b)*d+"%")),n.setAttribute(l+"1",c[o][0]+"%"),n.setAttribute(l+"2",c[o][1]+"%"),n.setAttribute("stroke",v.color),n.setAttribute("stroke-width","1");var w=i+"px",E=20;this.divElt.style.fontSize=this.fontSize,this.divElt.style.fontFamily=this.fontFamily,this.divElt.style.textAlign="center",this.divElt.style.border=this.barThickness+"px solid "+this.color,this.divElt.style.backgroundColor=this.backgroundColor;for(var b=0;b<this.nMajorGradations-1;b++){var p=document.createTextNode(s*(b+1)/this.nMajorGradations+" "+a);this.scaleNumbers[b].appendChild(p)}this.orientation===t.ScalebarOrientation.HORIZONTAL&&(this.svgElt.style.display="block",this.svgEltLabels.style.display="block"),E=0;for(var g=0;g<this.scaleNumbers.length;g++){var m;E=(m=this.orientation===t.ScalebarOrientation.HORIZONTAL?this.scaleNumbers[g].getBBox().height:this.scaleNumbers[g].getBBox().width)>E?m:E}this.orientation===t.ScalebarOrientation.HORIZONTAL?(this.divElt.style.width=w,this.divElt.style.height=20+E+10+"px",this.svgElt.style.width="100%",this.svgElt.style.height="20px",this.svgEltLabels.style.width="100%",this.svgEltLabels.style.height=E+"px",this.svgEltLabels.style.padding="5px 0"):(this.svgEltLabels.style.display="",this.svgEltLabels.style.width=E+"px",this.svgEltLabels.style.height="100%",this.svgEltLabels.style.padding="0 5px",this.svgElt.style.width="20px",this.svgElt.style.height="100%",this.divElt.style.width=20+E+10+"px",this.divElt.style.height=w)},getScalebarLocation:function(){if(this.location===t.ScalebarLocation.TOP_LEFT){var i=0,e=0;if(this.stayInsideImage){n=this.viewer.viewport.pixelFromPoint(new t.Point(0,0),!0);this.viewer.wrapHorizontal||(i=Math.max(n.x,0)),this.viewer.wrapVertical||(e=Math.max(n.y,0))}return new t.Point(i+this.xOffset,e+this.yOffset)}if(this.location===t.ScalebarLocation.TOP_RIGHT){var s=this.divElt.offsetWidth,i=(r=this.viewer.container).offsetWidth-s,e=0;if(this.stayInsideImage){n=this.viewer.viewport.pixelFromPoint(new t.Point(1,0),!0);this.viewer.wrapHorizontal||(i=Math.min(i,n.x-s)),this.viewer.wrapVertical||(e=Math.max(e,n.y))}return new t.Point(i-this.xOffset,e+this.yOffset)}if(this.location===t.ScalebarLocation.BOTTOM_RIGHT){var s=this.divElt.offsetWidth,a=this.divElt.offsetHeight,i=(r=this.viewer.container).offsetWidth-s,e=r.offsetHeight-a;if(this.stayInsideImage){n=this.viewer.viewport.pixelFromPoint(new t.Point(1,1/this.viewer.source.aspectRatio),!0);this.viewer.wrapHorizontal||(i=Math.min(i,n.x-s)),this.viewer.wrapVertical||(e=Math.min(e,n.y-a))}return new t.Point(i-this.xOffset,e-this.yOffset)}if(this.location===t.ScalebarLocation.BOTTOM_LEFT){var a=this.divElt.offsetHeight,i=0,e=(r=this.viewer.container).offsetHeight-a;if(this.stayInsideImage){n=this.viewer.viewport.pixelFromPoint(new t.Point(0,1/this.viewer.source.aspectRatio),!0);this.viewer.wrapHorizontal||(i=Math.max(i,n.x)),this.viewer.wrapVertical||(e=Math.min(e,n.y-a))}return new t.Point(i+this.xOffset,e-this.yOffset)}if(this.location===t.ScalebarLocation.MIDDLE_LEFT){var a=this.divElt.offsetHeight,i=0,e=(r=this.viewer.container).offsetHeight/2-a;if(this.stayInsideImage){n=this.viewer.viewport.pixelFromPoint(new t.Point(0,1/this.viewer.source.aspectRatio),!0);this.viewer.wrapHorizontal||(i=Math.max(i,n.x)),this.viewer.wrapVertical||(e=Math.min(e,n.y/2-a))}return new t.Point(i+this.xOffset,e-this.yOffset)}if(this.location===t.ScalebarLocation.MIDDLE_RIGHT){var s=this.divElt.offsetWidth,a=this.divElt.offsetHeight,i=(r=this.viewer.container).offsetWidth-s,e=r.offsetHeight/2-a;if(this.stayInsideImage){n=this.viewer.viewport.pixelFromPoint(new t.Point(1,1/this.viewer.source.aspectRatio),!0);this.viewer.wrapHorizontal||(i=Math.min(i,n.x-s)),this.viewer.wrapVertical||(e=Math.min(e,n.y/2-a))}return new t.Point(i-this.xOffset,e-this.yOffset)}if(this.location===t.ScalebarLocation.TOP_MIDDLE){var s=this.divElt.offsetWidth,i=(r=this.viewer.container).offsetWidth/2-s,e=0;if(this.stayInsideImage){n=this.viewer.viewport.pixelFromPoint(new t.Point(1,0),!0);this.viewer.wrapHorizontal||(i=Math.min(i,n.x/2-s)),this.viewer.wrapVertical||(e=Math.max(e,n.y))}return new t.Point(i-this.xOffset,e+this.yOffset)}if(this.location===t.ScalebarLocation.BOTTOM_MIDDLE){var s=this.divElt.offsetWidth,a=this.divElt.offsetHeight,r=this.viewer.container,i=r.offsetWidth/2-s,e=r.offsetHeight-a;if(this.stayInsideImage){var n=this.viewer.viewport.pixelFromPoint(new t.Point(1,1/this.viewer.source.aspectRatio),!0);this.viewer.wrapHorizontal||(i=Math.min(i,n.x/2-s)),this.viewer.wrapVertical||(e=Math.min(e,n.y-a))}return new t.Point(i-this.xOffset,e-this.yOffset)}},getAsCanvas:function(){var t=document.createElement("canvas");t.width=this.divElt.offsetWidth,t.height=this.divElt.offsetHeight;var i=t.getContext("2d");i.fillStyle=this.backgroundColor,i.fillRect(0,0,t.width,t.height),i.fillStyle=this.color,i.fillRect(0,t.height-this.barThickness,t.width,t.height),this.drawScalebar===this.drawMapScalebar&&(i.fillRect(0,0,this.barThickness,t.height),i.fillRect(t.width-this.barThickness,0,this.barThickness,t.height)),i.font=window.getComputedStyle(this.divElt).font,i.textAlign="center",i.textBaseline="middle",i.fillStyle=this.fontColor;var e=t.width/2,s=t.height/2;return i.fillText(this.divElt.textContent,e,s),t},getImageWithScalebarAsCanvas:function(){var t=this.viewer.drawer.canvas,i=document.createElement("canvas");i.width=t.width,i.height=t.height;var e=i.getContext("2d");e.drawImage(t,0,0);var s=this.getAsCanvas(),a=this.getScalebarLocation();return e.drawImage(s,a.x,a.y),i}},t.ScalebarSizeAndTextRenderer={METRIC_LENGTH:function(t,i){return s(t,i,"m")},IMPERIAL_LENGTH:function(t,i){var s=2*i,a=.0254*t;if(s<12*a)return s<a?e(a/1e3,i,"th"):e(a,i,"in");var r=12*a;return s<2e3*r?e(r,i,"ft"):e(5280*r,i,"mi")},ASTRONOMY:function(t,i){var s=2*i;if(s<60*t)return e(t,i,'"',!1,"");var a=60*t;return s<60*a?e(a,i,"'",!1,""):e(60*a,i,"&#176",!1,"")},STANDARD_TIME:function(t,i){var a=2*i;if(a<60*t)return s(t,i,"s");var r=60*t;if(a<60*r)return e(r,i,"minute",!0);var n=60*r;if(a<24*n)return e(n,i,"hour",!0);var o=24*n;return a<365.25*o?e(o,i,"day",!0):e(365.25*o,i,"year",!0)},METRIC_GENERIC:s}}(OpenSeadragon);